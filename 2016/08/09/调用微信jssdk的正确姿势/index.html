<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 调用微信jssdk的正确姿势 · Jesse's life</title><meta name="description" content="调用微信jssdk的正确姿势 - Jesse"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Jesse's life"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/jesseccchen" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/chenjiangsong" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">调用微信jssdk的正确姿势</h1><div class="post-info">Aug 9, 2016</div><div class="post-content"><h1 id="姿势步骤"><a href="#姿势步骤" class="headerlink" title="姿势步骤"></a>姿势步骤</h1><h2 id="引入js"><a href="#引入js" class="headerlink" title="引入js"></a>引入js</h2><p>//todo截图</p><h2 id="wx-config"><a href="#wx-config" class="headerlink" title="wx.config()"></a>wx.config()</h2><p>//todo截图</p><h2 id="wx-ready"><a href="#wx-ready" class="headerlink" title="wx.ready()"></a>wx.ready()</h2><p>//todo截图</p><h2 id="wx-error"><a href="#wx-error" class="headerlink" title="wx.error()"></a>wx.error()</h2><p>//todo截图<br><a id="more"></a></p><h1 id="引入js-1"><a href="#引入js-1" class="headerlink" title="引入js"></a>引入js</h1><p>html模板里加上<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;script src=&quot;http://res.wx.qq.com/open/js/jweixin-1.1.0.js&quot;&gt;&lt;/script&gt;</div></pre></td></tr></table></figure><p></p><p>//todo template.vm里的js截图</p><h1 id="wx-config-1"><a href="#wx-config-1" class="headerlink" title="wx.config()"></a>wx.config()</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">wx.config(&#123;</div><div class="line">    debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。</div><div class="line">    appId: &apos;&apos;, // 必填，企业号的唯一标识，此处填写企业号corpid</div><div class="line">    timestamp: , // 必填，生成签名的时间戳</div><div class="line">    nonceStr: &apos;&apos;, // 必填，生成签名的随机串</div><div class="line">    signature: &apos;&apos;,// 必填，签名，见下面</div><div class="line">    jsApiList: [] // 必填，需要使用的JS接口列表</div><div class="line">&#125;);</div></pre></td></tr></table></figure><h2 id="签名（调用sdk最复杂也是最核心的部分）"><a href="#签名（调用sdk最复杂也是最核心的部分）" class="headerlink" title="签名（调用sdk最复杂也是最核心的部分）"></a>签名（调用sdk最复杂也是最核心的部分）</h2><h3 id="设置可信域名"><a href="#设置可信域名" class="headerlink" title="设置可信域名"></a>设置可信域名</h3><p>1.先在微信企业号后台配置可信域名，只有在可信域名下的页面才有资格调用微信jssdk<br><img src="http://ob3wg7deo.bkt.clouddn.com/QQ20160809-0@2x.png" alt=""></p><p>2.可信域名必须是备案过的域名，须写上端口号（不写则默认80端口）</p><p>3.本地调试时可以随便设置一个备过案的域名(www.baidu.com)，然后用gas mask设置代理</p><h3 id="获取appId和appsecret"><a href="#获取appId和appsecret" class="headerlink" title="获取appId和appsecret"></a>获取appId和appsecret</h3><p><img src="http://ob3wg7deo.bkt.clouddn.com/QQ20160809-1@2x.png" alt="获取appId和appsecret"></p><h4 id="和服务号不同点"><a href="#和服务号不同点" class="headerlink" title="和服务号不同点"></a>和服务号不同点</h4><h5 id="企业号里叫作CorpID和Secret，服务号叫作appId和appsecret"><a href="#企业号里叫作CorpID和Secret，服务号叫作appId和appsecret" class="headerlink" title="企业号里叫作CorpID和Secret，服务号叫作appId和appsecret"></a>企业号里叫作CorpID和Secret，服务号叫作appId和appsecret</h5><h5 id="企业号里每个管理组都有独立的secret，服务号只有1个appsecret"><a href="#企业号里每个管理组都有独立的secret，服务号只有1个appsecret" class="headerlink" title="企业号里每个管理组都有独立的secret，服务号只有1个appsecret"></a>企业号里每个管理组都有独立的secret，服务号只有1个appsecret</h5><h3 id="获取AccessToken-get方式"><a href="#获取AccessToken-get方式" class="headerlink" title="获取AccessToken(get方式)"></a>获取AccessToken(get方式)</h3><blockquote><p><a href="https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=id&amp;corpsecret=secrect" target="_blank" rel="external">https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=id&amp;corpsecret=secrect</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">   &quot;access_token&quot;: &quot;accesstoken000001&quot;,</div><div class="line">   &quot;expires_in&quot;: 7200</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="获取jsapi-ticket-get方式"><a href="#获取jsapi-ticket-get方式" class="headerlink" title="获取jsapi_ticket(get方式)"></a>获取jsapi_ticket(get方式)</h3><blockquote><p><a href="https://qyapi.weixin.qq.com/cgi-bin/get_jsapi_ticket?access_token=ACCESS_TOKE" target="_blank" rel="external">https://qyapi.weixin.qq.com/cgi-bin/get_jsapi_ticket?access_token=ACCESS_TOKE</a></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">&quot;errcode&quot;:0,</div><div class="line">&quot;errmsg&quot;:&quot;ok&quot;,</div><div class="line">&quot;ticket&quot;:&quot;bxLdikRXVbTPdHSM05e5u5sUoXNKd8-41ZO3MhKoyN5OfkWITDGgnr2fwJ0m9E8NYzWKVZvdVtaUgWvsdshFKA&quot;,</div><div class="line">&quot;expires_in&quot;:7200</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="sha1签名"><a href="#sha1签名" class="headerlink" title="sha1签名"></a>sha1签名</h3><h4 id="签名所需元素"><a href="#签名所需元素" class="headerlink" title="签名所需元素"></a>签名所需元素</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">noncestr=Wm3WZYTPz0wzccnW</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jsapi_ticket=sM4AOVdWfPE4DxkXGEs8VMCPGGVi4C3VM0P37wVUCFvkVAy_90u5h9nbSlYy3-Sl-HhTdfl2fzFy1AOcHKP7qg</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">timestamp=1414587457</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">url=http://mp.weixin.qq.com //需调用jssdk页面的url</div></pre></td></tr></table></figure><h4 id="按字典序排列拼接成字符串"><a href="#按字典序排列拼接成字符串" class="headerlink" title="按字典序排列拼接成字符串"></a>按字典序排列拼接成字符串</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jsapi_ticket=sM4AOVdWfPE4DxkXGEs8VMCPGGVi4C3VM0P37wVUCFvkVAy_90u5h9nbSlYy3-Sl-HhTdfl2fzFy1AOcHKP7qg&amp;noncestr=Wm3WZYTPz0wzccnW&amp;timestamp=1414587457&amp;url=http://mp.weixin.qq.com</div></pre></td></tr></table></figure><h4 id="进行sha1签名"><a href="#进行sha1签名" class="headerlink" title="进行sha1签名"></a>进行sha1签名</h4><p>得到<br></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">0f9de62fce790f9a083d5c99e95740ceb90c27ed</div></pre></td></tr></table></figure><p></p><h4 id="附赠python手动sha1签名代码"><a href="#附赠python手动sha1签名代码" class="headerlink" title="附赠python手动sha1签名代码"></a>附赠python手动sha1签名代码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">import hashlib</div><div class="line">a = &apos;jsapi_ticket=sM4AOVdWfPE4DxkXGEs8VMCPGGVi4C3VM0P37wVUCFvkVAy_90u5h9nbSlYy3-Sl-HhTdfl2fzFy1AOcHKP7qg&amp;noncestr=Wm3WZYTPz0wzccnW&amp;timestamp=1414587457&amp;url=http://mp.weixin.qq.com&apos;</div><div class="line">print hashlib.sha1(a).hexdigest()</div></pre></td></tr></table></figure><h2 id="jsApiList"><a href="#jsApiList" class="headerlink" title="jsApiList"></a>jsApiList</h2><p>所有需要用到的api接口都要写在这里！不写就还是不给用~</p><h1 id="wx-ready-1"><a href="#wx-ready-1" class="headerlink" title="wx.ready()"></a>wx.ready()</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wx.ready(function()&#123;</div><div class="line">    // config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中。</div><div class="line">&#125;);</div></pre></td></tr></table></figure><h1 id="wx-error-1"><a href="#wx-error-1" class="headerlink" title="wx.error()"></a>wx.error()</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wx.error(function(res)&#123;</div><div class="line">    // config信息验证失败会执行error函数，如签名过期导致验证失败，具体错误信息可以打开config的debug模式查看，也可以在返回的res参数中查看，对于SPA可以在这里更新签名。</div><div class="line">&#125;);</div></pre></td></tr></table></figure></div></article></div></section><footer><div class="paginator"><a href="/2016/09/03/hello-world/" class="prev">PREV</a><a href="/2016/08/08/安装node-sass/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname="seansun",disqus_identifier="2016/08/09/调用微信jssdk的正确姿势/",disqus_title="调用微信jssdk的正确姿势",disqus_url="http://yoursite.com/2016/08/09/调用微信jssdk的正确姿势/";!function(){var s=document.createElement("script");s.type="text/javascript",s.async=!0,s.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(s)}()</script><script id="dsq-count-scr" src="//seansun.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2016 <a href="http://yoursite.com">Jesse</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>!function(e,t,a,n,c,o){e.GoogleAnalyticsObject=n,e[n]||(e[n]=function(){(e[n].q=e[n].q||[]).push(arguments)}),e[n].l=+new Date,c=t.createElement(a),o=t.getElementsByTagName(a)[0],c.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script","ga"),ga("create","UA-65933410-1","auto"),ga("send","pageview")</script></body></html>